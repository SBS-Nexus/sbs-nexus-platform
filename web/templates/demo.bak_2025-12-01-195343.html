<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Upload - SBS KI-Rechnungsverarbeitung</title>
    <link rel="stylesheet" href="/static/css/design-tokens.css">
  <link rel="stylesheet" href="/static/css/components.css">
  <link rel="stylesheet" href="/static/css/main.css">
    <style>
    .hero-compact {
      background: linear-gradient(135deg, #003856 0%, #004d73 100%);
      color: white;
      padding: 60px 24px;
      text-align: center;
    }
    .hero-badge {
      display: inline-block;
      background: rgba(255,185,0,0.15);
      color: #FFB900;
      padding: 8px 20px;
      border-radius: 24px;
      font-weight: 600;
      margin-bottom: 20px;
    }
    .hero-compact h1 {
      font-size: 2.5rem;
      margin-bottom: 16px;
      color: white;
    }
    .hero-compact p {
      font-size: 1.1rem;
      opacity: 0.9;
      max-width: 700px;
      margin: 0 auto;
    }
    .footer {
      background: #003856;
      color: white;
      padding: 40px 24px 20px;
    }
    .footer-grid {
      max-width: 1200px;
      margin: 0 auto 30px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 30px;
    }
    .footer-bottom {
      max-width: 1200px;
      margin: 0 auto;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,0.1);
      text-align: center;
      font-size: 0.9rem;
      opacity: 0.7;
    }
    
    /* Animierter Ladebalken */
    @keyframes loading-wave {
      0% { left: -100%; }
      50% { left: 100%; }
      100% { left: -100%; }
    }
    
    .progress-bar {
      position: relative;
      overflow: hidden;
    }
    
    .progress-bar::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(0,255,0,0.3) 25%, 
        rgba(0,255,0,0.6) 50%, 
        rgba(0,255,0,0.3) 75%, 
        transparent
      );
      animation: loading-wave 2s ease-in-out infinite;
    }
  
/* Skeleton Loading Animations */
.skeleton {
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: skeleton-loading 1.5s ease-in-out infinite;
  border-radius: 8px;
}

@keyframes skeleton-loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

.skeleton-card {
  background: white;
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 16px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.skeleton-title {
  height: 24px;
  width: 60%;
  margin-bottom: 16px;
}

.skeleton-text {
  height: 16px;
  margin-bottom: 12px;
}

.skeleton-text.short { width: 40%; }
.skeleton-text.medium { width: 70%; }
.skeleton-text.long { width: 90%; }

.skeleton-circle {
  width: 48px;
  height: 48px;
  border-radius: 50%;
}

.skeleton-stat {
  background: white;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.skeleton-chart {
  height: 200px;
  width: 100%;
  border-radius: 12px;
}

/* Button Loading States */
.btn-loading {
  position: relative;
  pointer-events: none;
  opacity: 0.7;
}

.btn-loading::after {
  content: '';
  position: absolute;
  width: 16px;
  height: 16px;
  top: 50%;
  left: 50%;
  margin-left: -8px;
  margin-top: -8px;
  border: 2px solid #ffffff;
  border-radius: 50%;
  border-top-color: transparent;
  animation: btn-spin 0.6s linear infinite;
}

@keyframes btn-spin {
  to { transform: rotate(360deg); }
}

/* Fade-in for content */
.fade-in {
  animation: fadeIn 0.4s ease-in;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

</style>
</head>
<body>

<header class="header">
  <div class="header-inner">
    <a href="/" class="logo-wrap">
      <img src="/static/sbs-logo-new.png" alt="SBS Deutschland" class="logo-img" />
      <div class="logo-text"><strong>SBS Deutschland</strong><span>Smart Business Service ¬∑ Weinheim</span></div>
    </a>

    <button class="burger" id="burger" aria-label="Men√º">
      <span></span><span></span><span></span>
    </button>

    <nav class="nav" id="nav">
      <a href="/">Upload</a>
      <a href="/history">Verlauf</a>
      <a href="/analytics">Analytics</a>
      <a href="/email-config">Email-Inbox</a>
      <a href="/copilot">Copilot</a>

      <div class="account-dropdown">
        <span class="account-toggle">üë§ <span id="accountName">Account</span> ‚ñæ</span>
        <div class="account-menu">
          <div class="section-label">Workspace</div>
          <a href="/">üì• Upload</a>
          <a href="/history">üìä Verlauf</a>
          <a href="/analytics">üìà Analytics</a>
          <a href="/email-config">üìß Email-Inbox</a>

          <div class="divider"></div>
          <div class="section-label">Konto</div>
          <a href="/account">üí≥ Konto &amp; Nutzung</a>
          <a href="/team">üë• Team &amp; Rollen</a>
          <a href="/audit-log">üìú Audit-Log</a>
          <a href="/profile">‚öôÔ∏è Einstellungen</a>
          <a href="/logout">üö™ Logout</a>
        </div>
      </div>
    </nav>
  </div>
</header>

<main class="main-content">
  <div class="hero-compact">
    <div class="hero-content">
      <div class="hero-badge">ü§ñ KI-RECHNUNGSVERARBEITUNG</div>
      <h1>Rechnungen intelligent verarbeiten</h1>
      <p>Laden Sie Ihre Rechnungen hoch und unsere KI extrahiert automatisch alle relevanten Daten</p>
    </div>
  </div>

  <section style="max-width:1200px;margin:60px auto;padding:0 24px;">
    <div id="uploadBox" class="upload-dropzone" style="margin-bottom:40px;">
  <!-- Sterne / Hintergrund -->
  <div class="bh-bg"></div>

  <!-- Gravitationslinse -->
  <div class="bh-lensing-ring"></div>

  <!-- Akkretionsscheibe (gl√ºhender, orangener Ring) -->
  <div class="bh-disc"></div>

  <!-- Ereignishorizont (absolut schwarzes Zentrum) -->
  <div class="bh-horizon"></div>

  <!-- Partikel/Materie -->
  <div class="bh-particles-layer" aria-hidden="true"></div>

  <!-- UI-Inhalte -->
  <div class="bh-ui">
    <div class="bh-ui-badge">LIVE DEMO ¬∑ Schwarzes Loch</div>
    <h2 class="bh-ui-title">Rechnungen ins Schwarze Loch ziehen</h2>
    <p class="bh-ui-text">
      Ziehen Sie zwei Demo-Rechnungen oder eigene PDF-Belege in das Schwarze Loch.
      Beim Verarbeiten werden sie zu Materie und am Ereignishorizont verschlungen.
    </p>

    <div class="bh-ui-actions">
      <button type="button" class="bh-btn-primary" id="bh-browse-btn">
        Dateien ausw√§hlen
      </button>
      <span class="bh-hint">‚Ä¶oder Dateien einfach auf das Schwarze Loch ziehen</span>
    </div>
  </div>

</div>
      <h2 class="dropzone-text"><strong>Dateien hochladen</strong></h2>
        <div id="upload-status" style="margin-top: 20px;"></div>
      <p class="dropzone-text">Klicken oder Dateien hierher ziehen</p>
      <p class="dropzone-formats">PDF, JPG oder PNG (max. 20 MB pro Datei)</p>
    </div>

    <div id="fileListBox" class="card" style="display:none;margin-bottom:40px;"><div class="card-body">
      <h3 style="color:#003856;margin-bottom:24px;">üìã Hochgeladene Dateien (<span id="fileCount">0</span>)</h3>
      <div id="fileList" style="max-height:550px;overflow-y:auto;margin-bottom:20px;"></div>
      <button id="processBtn" class="btn btn-accent btn-lg btn-block">‚ö° Jetzt verarbeiten</button>
    </div>

    <div id="progressBox" style="display:none;background:white;border-radius:16px;padding:60px 40px;text-align:center;box-shadow:0 4px 16px rgba(0,0,0,0.08);">
      <div style="font-size:4rem;margin-bottom:24px;">‚öôÔ∏è</div>
      <h2 style="color:#003856;margin-bottom:16px;">Verarbeitung l√§uft...</h2>
      <div class="progress-bar" style="width:100%;height:40px;background:#e5e7eb;border-radius:20px;overflow:hidden;margin:30px 0;position:relative;">
        <div id="progressFill" style="height:100%;background:linear-gradient(90deg,#003856 0%,#FFB900 100%);width:0%;transition:width 0.3s;"></div>
      </div>
      <p id="progressText" style="color:#666;font-size:1.1rem;">Bitte warten...</p>
    </div>
  </section>
</main>

<footer class="footer">
  <div class="footer-grid">
    <div>
      <div class="footer-brand">
        <img src="/static/sbs-logo-new.png" alt="SBS Deutschland" />
        <div class="footer-brand-text">
          <strong>SBS Deutschland</strong>
          <span>Smart Business Service</span>
        </div>
      </div>
      <p class="footer-tagline">
        Ihr Partner f√ºr intelligente Gesch√§ftsprozesse und KI-L√∂sungen aus der Rhein-Neckar-Region.
      </p>
      <div class="footer-location">üìç In der Dell 19, 69469 Weinheim</div>
    </div>

    <div>
      <h4>Produkte</h4>
      <ul>
        <li><a href="/landing">KI-Rechnungsverarbeitung</a></li>
        <li><a href="/preise">Preise &amp; Pakete</a></li>
        <li><a href="https://app.sbsdeutschland.com/">Demo &amp; Upload</a></li>
      </ul>
    </div>

    <div>
      <h4>Unternehmen</h4>
      <ul>
        <li><a href="/sbshomepage/unternehmen.html">√úber uns</a></li>
        <li><a href="/sbshomepage/kontakt.html">Kontakt</a></li>
        <li><a href="/sbshomepage/it-consulting.html">IT Consulting</a></li>
        <li><a href="/sbshomepage/sap-consulting.html">SAP Consulting</a></li>
      </ul>
    </div>

    <div>
      <h4>Rechtliches</h4>
      <ul>
        <li><a href="/sbshomepage/impressum.html">Impressum</a></li>
        <li><a href="/sbshomepage/datenschutz.html">Datenschutz</a></li>
        <li><a href="/sbshomepage/agb.html">AGB</a></li>
      </ul>
    </div>
  </div>

  <div class="footer-bottom">
    <p>&copy; 2026 SBS Deutschland GmbH &amp; Co. KG. Alle Rechte vorbehalten.</p>
    <p>Enterprise KI-Plattform ¬∑ Weinheim</p>
  </div>
</footer>


<script src="/static/js/main.js"></script>
<script>
let files=[];
const fileInput=document.getElementById('fileInput');
const uploadBox=document.getElementById('uploadBox');
const fileListBox=document.getElementById('fileListBox');
const fileList=document.getElementById('fileList');
uploadBox.onclick=()=>fileInput.click();
fileInput.onchange=(e)=>addFiles(e.target.files);
uploadBox.ondragover=(e)=>{e.preventDefault();uploadBox.classList.add('dropzone--active');};
uploadBox.ondragleave=()=>uploadBox.classList.remove('dropzone--active');
uploadBox.ondrop=(e)=>{e.preventDefault();uploadBox.classList.remove('dropzone--active');addFiles(e.dataTransfer.files);};
function addFiles(newFiles){for(let f of newFiles){if(f.size>20*1024*1024){showError('file_too_large', f.name + ' ist zu gro√ü (max. 20 MB)');continue;}files.push(f);}showFiles();}
function showFiles(){if(files.length===0){fileListBox.style.display='none';return;}fileListBox.style.display='block';document.getElementById('fileCount').textContent=files.length;fileList.innerHTML='';files.forEach((f,i)=>{const icon=f.type==='application/pdf'?'üìï':'üñºÔ∏è';const div=document.createElement('div');div.style='display:flex;justify-content:space-between;align-items:center;padding:20px;border:1px solid #e5e7eb;border-radius:12px;margin-bottom:12px;';div.innerHTML='<div style="display:flex;align-items:center;gap:20px;"><span style="font-size:2.5rem;">'+icon+'</span><div><div style="font-weight:600;color:#003856;">'+f.name+'</div><div style="font-size:0.9rem;color:#666;">'+(f.size/1024/1024).toFixed(2)+' MB</div></div></div><button onclick="removeFile('+i+')" style="background:#ef4444;color:white;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-weight:600;">‚úï</button>';fileList.appendChild(div);});}
function removeFile(i){files.splice(i,1);showFiles();}
document.getElementById('processBtn').onclick=async()=>{const btn=document.getElementById('processBtn');if(files.length===0)return;btn.classList.add('btn-loading');btn.disabled=true;uploadBox.style.display='none';fileListBox.style.display='none';document.getElementById('progressBox').style.display='block';try{const fd=new FormData();files.forEach(f=>fd.append('files',f));console.log('Uploading',files.length,'files');const r=await fetch('/api/upload',{method:'POST',body:fd});const data=await r.json();console.log('Upload:',data);if(data.error){showToast(data.error, 'error');if(data.redirect)window.location.href=data.redirect;return;}const jobId=data.batch_id;console.log('Job:',jobId);connectWebSocket(jobId);showToast('Upload erfolgreich! Verarbeitung gestartet...', 'success', 2000);await fetch('/api/process/'+jobId,{method:'POST'});pollProgress(jobId);}catch(e){alert('Fehler: '+e.message);console.error(e);document.getElementById('progressBox').style.display='none';fileListBox.style.display='block';}};
async function pollProgress(jobId){const timer=setInterval(async()=>{try{const r=await fetch('/api/status/'+jobId);const d=await r.json();if(d.status==='completed'){clearInterval(timer);window.location.href='/job/'+jobId;}else if(d.status==='error'){clearInterval(timer);showError('processing_failed', 'Verarbeitung konnte nicht abgeschlossen werden');}document.getElementById('progressFill').style.width=((d.processed||0)/(d.total||1)*100)+'%';document.getElementById('progressText').textContent=(d.processed||0)+' von '+(d.total||0)+' Dateien';}catch(e){}},2000);}
fetch('/api/user').then(r=>r.json()).then(u=>{
  const toggle = document.querySelector('.account-toggle');
  const menu = document.querySelector('.account-menu');
  if(u.logged_in && u.name) {
    document.getElementById('accountName').textContent=u.name;
  } else {
    toggle.innerHTML = '<a href="/login?next=/" style="text-decoration:none;color:inherit;">üîë Login</a>';
    if(menu) menu.style.display = 'none';
  }
});
</script>
<!-- Toast Container -->
<div id="toastContainer" style="position:fixed;top:20px;right:20px;z-index:9999;"></div>

<style>
.toast {
  min-width: 300px;
  max-width: 400px;
  padding: 16px 20px;
  margin-bottom: 12px;
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.15);
  display: flex;
  align-items: center;
  gap: 12px;
  animation: slideIn 0.3s ease-out;
  background: white;
  border-left: 4px solid;
}

.toast.success { border-color: #22c55e; }
.toast.error { border-color: #ef4444; }
.toast.info { border-color: #3b82f6; }
.toast.warning { border-color: #f59e0b; }

.toast-icon {
  font-size: 1.5rem;
  flex-shrink: 0;
}

.toast-content {
  flex: 1;
}

.toast-title {
  font-weight: 600;
  color: #1f2937;
  margin-bottom: 4px;
}

.toast-message {
  font-size: 0.9rem;
  color: #6b7280;
}

.toast-close {
  background: none;
  border: none;
  font-size: 1.2rem;
  color: #9ca3af;
  cursor: pointer;
  padding: 0;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
}

.toast-close:hover {
  background: #f3f4f6;
  color: #4b5563;
}

@keyframes slideIn {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes slideOut {
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(400px);
    opacity: 0;
  }
}

<style>
.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 60px 24px;
  text-align: center;
  background: white;
  border-radius: 16px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  margin: 40px auto;
  max-width: 500px;
}

.empty-state-icon {
  font-size: 4rem;
  margin-bottom: 24px;
  opacity: 0.5;
}

.empty-state-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 12px;
}

.empty-state-description {
  font-size: 1rem;
  color: #6b7280;
  margin-bottom: 24px;
  line-height: 1.6;
}

.empty-state-action {
  background: linear-gradient(135deg, #FFB900 0%, #ff9500 100%);
  color: #003856;
  border: none;
  padding: 14px 32px;
  border-radius: 10px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  text-decoration: none;
  display: inline-block;
  transition: all 0.3s;
  box-shadow: 0 4px 12px rgba(255,185,0,0.3);
}

.empty-state-action:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(255,185,0,0.4);
}

.empty-state-tips {
  background: #f9fafb;
  border-radius: 12px;
  padding: 20px;
  margin-top: 24px;
  text-align: left;
}

.empty-state-tips h4 {
  color: #374151;
  margin-bottom: 12px;
  font-size: 0.9rem;
  font-weight: 600;
}

.empty-state-tips ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.empty-state-tips li {
  color: #6b7280;
  font-size: 0.85rem;
  padding: 8px 0;
  padding-left: 24px;
  position: relative;
}

.empty-state-tips li::before {
  content: "‚úì";
  position: absolute;
  left: 0;
  color: #22c55e;
  font-weight: bold;
}
</style>

</style>

<script>
function showToast(message, type = 'info', duration = 4000) {
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  
  const icons = {
    success: '‚úÖ',
    error: '‚ùå',
    info: '‚ÑπÔ∏è',
    warning: '‚ö†Ô∏è'
  };
  
  const titles = {
    success: 'Erfolg',
    error: 'Fehler',
    info: 'Information',
    warning: 'Warnung'
  };
  
  toast.innerHTML = `
    <div class="toast-icon">${icons[type]}</div>
    <div class="toast-content">
      <div class="toast-title">${titles[type]}</div>
      <div class="toast-message">${message}</div>
    </div>
    <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>
  `;
  
  container.appendChild(toast);
  
  // Auto-remove nach duration
  setTimeout(() => {
    toast.style.animation = 'slideOut 0.3s ease-in';
    setTimeout(() => toast.remove(), 300);
  }, duration);
}
</script>

<style>
/* Onboarding Tour Overlay */
.onboarding-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  z-index: 9999;
  backdrop-filter: blur(3px);
}

.onboarding-overlay.active {
  display: block;
  animation: fadeIn 0.3s ease-out;
}

/* Welcome Card */
.onboarding-welcome {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  border-radius: 20px;
  padding: 50px 40px;
  max-width: 500px;
  text-align: center;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  animation: scaleIn 0.4s ease-out;
}

@keyframes scaleIn {
  from {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.9);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
}

.onboarding-welcome h2 {
  font-size: 2rem;
  margin-bottom: 16px;
  color: #1f2937;
}

.onboarding-welcome p {
  font-size: 1.1rem;
  color: #6b7280;
  line-height: 1.6;
  margin-bottom: 32px;
}

.onboarding-buttons {
  display: flex;
  gap: 12px;
}

.onboarding-btn {
  flex: 1;
  padding: 14px 24px;
  border-radius: 10px;
  font-weight: 600;
  cursor: pointer;
  border: none;
  transition: all 0.3s;
  font-size: 1rem;
}

.onboarding-btn-primary {
  background: linear-gradient(135deg, #FFB900 0%, #ff9500 100%);
  color: #003856;
  box-shadow: 0 4px 12px rgba(255,185,0,0.3);
}

.onboarding-btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(255,185,0,0.4);
}

.onboarding-btn-secondary {
  background: white;
  color: #6b7280;
  border: 2px solid #e5e7eb;
}

.onboarding-btn-secondary:hover {
  border-color: #d1d5db;
  background: #f9fafb;
}

/* Tour Tooltip */
.tour-tooltip {
  position: fixed;
  background: white;
  border-radius: 16px;
  padding: 24px;
  max-width: 350px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  z-index: 10001;
  animation: tooltipSlideIn 0.3s ease-out;
}

@keyframes tooltipSlideIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.tour-tooltip-header {
  display: flex;
  justify-content: space-between;
  align-items: start;
  margin-bottom: 16px;
}

.tour-tooltip-step {
  background: linear-gradient(135deg, #FFB900, #ff9500);
  color: #003856;
  font-weight: 700;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.85rem;
}

.tour-tooltip-close {
  background: none;
  border: none;
  font-size: 1.3rem;
  color: #9ca3af;
  cursor: pointer;
  padding: 0;
  width: 24px;
  height: 24px;
}

.tour-tooltip-title {
  font-size: 1.3rem;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 12px;
}

.tour-tooltip-description {
  color: #6b7280;
  line-height: 1.6;
  margin-bottom: 20px;
}

.tour-tooltip-actions {
  display: flex;
  gap: 8px;
}

.tour-btn {
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  border: none;
  font-size: 0.9rem;
}

.tour-btn-next {
  background: linear-gradient(135deg, #FFB900, #ff9500);
  color: #003856;
  flex: 1;
}

.tour-btn-skip {
  background: #f3f4f6;
  color: #6b7280;
}

/* Highlight Element */
.tour-highlight {
  position: relative;
  z-index: 10000;
  box-shadow: 0 0 0 4px #FFB900, 0 0 0 9999px rgba(0,0,0,0.7);
  border-radius: 8px;
}
</style>

<!-- Onboarding Tour HTML -->
<div id="onboardingOverlay" class="onboarding-overlay">
  <!-- Welcome Screen -->
  <div id="onboardingWelcome" class="onboarding-welcome">
    <div style="font-size: 3rem; margin-bottom: 20px;">üëã</div>
    <h2>Willkommen bei SBS!</h2>
    <p>Lass uns gemeinsam einen kurzen Rundgang machen. Wir zeigen dir die wichtigsten Funktionen der KI-Rechnungsverarbeitung.</p>
    <div class="onboarding-buttons">
      <button class="onboarding-btn onboarding-btn-secondary" onclick="skipTour()">√úberspringen</button>
      <button class="onboarding-btn onboarding-btn-primary" onclick="startTour()">üöÄ Los geht's!</button>
    </div>
  </div>
  
  <!-- Tour Tooltip (wird dynamisch positioniert) -->
  <div id="tourTooltip" class="tour-tooltip" style="display: none;">
    <div class="tour-tooltip-header">
      <span id="tourStep" class="tour-tooltip-step">Schritt 1 von 4</span>
      <button class="tour-tooltip-close" onclick="skipTour()">√ó</button>
    </div>
    <h3 id="tourTitle" class="tour-tooltip-title">Titel</h3>
    <p id="tourDescription" class="tour-tooltip-description">Beschreibung</p>
    <div class="tour-tooltip-actions">
      <button class="tour-btn tour-btn-skip" onclick="skipTour()">√úberspringen</button>
      <button class="tour-btn tour-btn-next" onclick="nextTourStep()">Weiter ‚Üí</button>
    </div>
  </div>
</div>

<script>
const tourSteps = [
  {
    target: '#uploadBox',
    title: 'üìÅ Upload-Bereich',
    description: 'Hier kannst du deine Rechnungen hochladen. Einfach klicken oder Dateien hierher ziehen. PDFs, JPGs und PNGs werden unterst√ºtzt.',
    position: 'bottom'
  },
  {
    target: '.account-dropdown',
    title: 'üë§ Dein Account',
    description: 'Hier findest du deinen Verlauf, Analytics, Email-Einstellungen und dein Profil. Alles an einem Ort.',
    position: 'left'
  },
  {
    target: 'a[href="/history"]',
    title: 'üìä Verlauf & Analytics',
    description: 'Sieh dir alle verarbeiteten Rechnungen an, exportiere Daten und analysiere deine Ausgaben mit intelligenten Insights.',
    position: 'bottom'
  },
  {
    target: '.hero-compact',
    title: '‚ú® Fertig!',
    description: 'Das war\'s! Du bist jetzt bereit, deine ersten Rechnungen zu verarbeiten. Viel Erfolg!',
    position: 'center'
  }
];

let currentStep = 0;

function checkOnboardingStatus() {
  const completed = localStorage.getItem('onboarding_completed');
  if (!completed && window.location.pathname === '/') {
    setTimeout(() => showOnboarding(), 1000);
  }
}

function showOnboarding() {
  document.getElementById('onboardingOverlay').classList.add('active');
  document.getElementById('onboardingWelcome').style.display = 'block';
}

function startTour() {
  document.getElementById('onboardingWelcome').style.display = 'none';
  currentStep = 0;
  showTourStep();
}

function showTourStep() {
  const step = tourSteps[currentStep];
  const tooltip = document.getElementById('tourTooltip');
  const target = document.querySelector(step.target);
  
  if (!target) {
    nextTourStep();
    return;
  }
  
  // Update tooltip content
  document.getElementById('tourStep').textContent = `Schritt ${currentStep + 1} von ${tourSteps.length}`;
  document.getElementById('tourTitle').textContent = step.title;
  document.getElementById('tourDescription').textContent = step.description;
  
  // Highlight target
  document.querySelectorAll('.tour-highlight').forEach(el => el.classList.remove('tour-highlight'));
  target.classList.add('tour-highlight');
  
  // Position tooltip
  const rect = target.getBoundingClientRect();
  tooltip.style.display = 'block';
  
  if (step.position === 'bottom') {
    tooltip.style.top = (rect.bottom + 20) + 'px';
    tooltip.style.left = (rect.left + rect.width / 2) + 'px';
    tooltip.style.transform = 'translateX(-50%)';
  } else if (step.position === 'left') {
    tooltip.style.top = (rect.top) + 'px';
    tooltip.style.left = (rect.left - 370) + 'px';
    tooltip.style.transform = 'none';
  } else if (step.position === 'center') {
    tooltip.style.top = '50%';
    tooltip.style.left = '50%';
    tooltip.style.transform = 'translate(-50%, -50%)';
  }
  
  // Last step button
  if (currentStep === tourSteps.length - 1) {
    document.querySelector('.tour-btn-next').textContent = 'üéâ Fertig!';
  }
}

function nextTourStep() {
  currentStep++;
  if (currentStep >= tourSteps.length) {
    completeTour();
  } else {
    showTourStep();
  }
}

function skipTour() {
  completeTour();
}

function completeTour() {
  localStorage.setItem('onboarding_completed', 'true');
  document.getElementById('onboardingOverlay').classList.remove('active');
  document.querySelectorAll('.tour-highlight').forEach(el => el.classList.remove('tour-highlight'));
  showToast && showToast('Tour abgeschlossen! üéâ', 'success', 3000);
}

// Check on page load
if (typeof window !== 'undefined') {
  checkOnboardingStatus();
}
</script>

<style>
/* Professional Error Display */
.error-container {
  max-width: 600px;
  margin: 40px auto;
  padding: 24px;
  background: white;
  border-radius: 16px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.1);
  border-left: 4px solid #ef4444;
}

.error-icon {
  font-size: 3rem;
  text-align: center;
  margin-bottom: 20px;
}

.error-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 12px;
  text-align: center;
}

.error-message {
  color: #6b7280;
  line-height: 1.6;
  margin-bottom: 24px;
  text-align: center;
}

.error-solutions {
  background: #f9fafb;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 24px;
}

.error-solutions h4 {
  color: #1f2937;
  font-weight: 600;
  margin-bottom: 12px;
  font-size: 1rem;
}

.error-solutions ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.error-solutions li {
  padding: 10px 0;
  padding-left: 28px;
  position: relative;
  color: #4b5563;
  font-size: 0.95rem;
}

.error-solutions li::before {
  content: "üí°";
  position: absolute;
  left: 0;
}

.error-actions {
  display: flex;
  gap: 12px;
}

.error-btn {
  flex: 1;
  padding: 12px 24px;
  border-radius: 10px;
  font-weight: 600;
  cursor: pointer;
  border: none;
  text-align: center;
  text-decoration: none;
  display: inline-block;
}

.error-btn-primary {
  background: linear-gradient(135deg, #FFB900 0%, #ff9500 100%);
  color: #003856;
  box-shadow: 0 4px 12px rgba(255,185,0,0.3);
}

.error-btn-secondary {
  background: white;
  color: #6b7280;
  border: 2px solid #e5e7eb;
}
</style>

<script>
// Enhanced error handler with solutions
const errorSolutions = {
  'file_too_large': {
    icon: 'üìÅ',
    title: 'Datei zu gro√ü',
    solutions: [
      'Komprimiere die PDF-Datei vor dem Hochladen',
      'Teile gro√üe Dateien in mehrere kleinere auf',
      'Maximale Dateigr√∂√üe: 20 MB pro Datei'
    ],
    actions: [
      { text: 'Neue Datei w√§hlen', type: 'primary', action: 'retry' },
      { text: 'Hilfe', type: 'secondary', action: 'help' }
    ]
  },
  'invalid_format': {
    icon: '‚ö†Ô∏è',
    title: 'Ung√ºltiges Dateiformat',
    solutions: [
      'Unterst√ºtzte Formate: PDF, JPG, PNG',
      'Konvertiere deine Datei in ein unterst√ºtztes Format',
      'Stelle sicher, dass die Datei nicht besch√§digt ist'
    ],
    actions: [
      { text: 'Andere Datei w√§hlen', type: 'primary', action: 'retry' }
    ]
  },
  'processing_failed': {
    icon: 'üîß',
    title: 'Verarbeitung fehlgeschlagen',
    solutions: [
      'Pr√ºfe ob die Rechnung gut lesbar ist',
      'Stelle sicher, dass alle relevanten Daten sichtbar sind',
      'Bei wiederholten Problemen kontaktiere den Support'
    ],
    actions: [
      { text: 'Erneut versuchen', type: 'primary', action: 'retry' },
      { text: 'Support kontaktieren', type: 'secondary', action: 'support' }
    ]
  },
  'network_error': {
    icon: 'üåê',
    title: 'Netzwerkfehler',
    solutions: [
      '√úberpr√ºfe deine Internetverbindung',
      'Aktualisiere die Seite und versuche es erneut',
      'Falls das Problem bestehen bleibt, warte kurz und versuche es nochmal'
    ],
    actions: [
      { text: 'Seite neu laden', type: 'primary', action: 'reload' },
      { text: 'Erneut versuchen', type: 'secondary', action: 'retry' }
    ]
  },
  'authentication_error': {
    icon: 'üîê',
    title: 'Anmeldefehler',
    solutions: [
      '√úberpr√ºfe deine Anmeldedaten',
      'Melde dich erneut an',
      'Falls du dein Passwort vergessen hast, setze es zur√ºck'
    ],
    actions: [
      { text: 'Zur Anmeldung', type: 'primary', action: 'login' }
    ]
  },
  'quota_exceeded': {
    icon: 'üìä',
    title: 'Kontingent √ºberschritten',
    solutions: [
      'Dein monatliches Kontingent ist aufgebraucht',
      'Upgrade auf einen h√∂heren Plan f√ºr mehr Rechnungen',
      'Warte bis zum n√§chsten Monat oder kontaktiere den Vertrieb'
    ],
    actions: [
      { text: 'Upgrade ansehen', type: 'primary', action: 'upgrade' },
      { text: 'Vertrieb kontaktieren', type: 'secondary', action: 'sales' }
    ]
  }
};

function showError(errorType, customMessage = null) {
  const error = errorSolutions[errorType] || {
    icon: '‚ùå',
    title: 'Ein Fehler ist aufgetreten',
    solutions: ['Bitte versuche es erneut', 'Bei weiteren Problemen kontaktiere den Support'],
    actions: [{ text: 'Erneut versuchen', type: 'primary', action: 'retry' }]
  };
  
  // Use toast for quick errors
  if (typeof showToast !== 'undefined' && !['quota_exceeded', 'authentication_error'].includes(errorType)) {
    showToast(customMessage || error.title, 'error', 5000);
    return;
  }
  
  // For critical errors, show full error page
  const errorHTML = `
    <div class="error-container">
      <div class="error-icon">${error.icon}</div>
      <h2 class="error-title">${error.title}</h2>
      ${customMessage ? `<p class="error-message">${customMessage}</p>` : ''}
      
      <div class="error-solutions">
        <h4>üí° L√∂sungsvorschl√§ge:</h4>
        <ul>
          ${error.solutions.map(s => `<li>${s}</li>`).join('')}
        </ul>
      </div>
      
      <div class="error-actions">
        ${error.actions.map(a => `
          <button class="error-btn error-btn-${a.type}" onclick="handleErrorAction('${a.action}')">
            ${a.text}
          </button>
        `).join('')}
      </div>
    </div>
  `;
  
  // Show in modal or dedicated area
  console.error(`Error: ${errorType}`, customMessage);
}

function handleErrorAction(action) {
  switch(action) {
    case 'retry':
      window.location.reload();
      break;
    case 'reload':
      window.location.reload();
      break;
    case 'login':
      window.location.href = '/login';
      break;
    case 'upgrade':
      window.location.href = '/pricing';
      break;
    case 'support':
      window.location.href = 'mailto:support@sbsdeutschland.com';
      break;
    case 'sales':
      window.location.href = 'mailto:vertrieb@sbsdeutschland.com';
      break;
    case 'help':
      window.open('https://sbsdeutschland.com/hilfe', '_blank');
      break;
  }
}

// Global error handler
window.addEventListener('error', function(e) {
  console.error('Global error:', e);
  showError('processing_failed', 'Ein unerwarteter Fehler ist aufgetreten');
});

// Network error detection
window.addEventListener('offline', function() {
  showError('network_error', 'Keine Internetverbindung');
});

    // === WebSocket Real-time Updates ===
    let ws = null;
    let currentJobId = null;
    
    function connectWebSocket(jobId) {
        currentJobId = jobId;
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        ws = new WebSocket(`${protocol}//${window.location.host}/ws/${jobId}`);
        
        ws.onopen = () => {
            console.log('‚úÖ WebSocket connected');
        };
        
        ws.onmessage = (event) => {
            const message = JSON.parse(event.data);
            handleWebSocketUpdate(message);
        };
        
        ws.onerror = (error) => {
            console.error('‚ùå WebSocket error:', error);
        };
        
        ws.onclose = () => {
            console.log('WebSocket closed');
        };
        
        // Heartbeat
        setInterval(() => {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({type: 'ping'}));
            }
        }, 30000);
    }
    
    function handleWebSocketUpdate(message) {
        console.log('üì° WebSocket update:', message);
        
        switch(message.type) {
            case 'progress':
                updateProgressUI(message);
                break;
            case 'invoice_complete':
                showInvoiceNotification(message.invoice);
                break;
            case 'job_complete':
                showJobComplete(message.summary);
                break;
            case 'error':
                showError(message.error);
                break;
        }
    }
    
    function updateProgressUI(data) {
        // Zeige Progress in der UI
        const statusDiv = document.getElementById('upload-status');
        if (statusDiv) {
            statusDiv.innerHTML = `
                <div style="margin: 20px 0;">
                    <div style="font-weight: bold; margin-bottom: 10px;">
                        ‚ö° Verarbeitung l√§uft: ${data.current} von ${data.total} Rechnungen
                    </div>
                    <div style="background: #e0e0e0; height: 30px; border-radius: 15px; overflow: hidden;">
                        <div style="background: linear-gradient(90deg, #003856 0%, #0066cc 100%); 
                                    height: 100%; width: ${data.percentage}%; 
                                    transition: width 0.3s; display: flex; align-items: center; 
                                    justify-content: center; color: white; font-weight: bold;">
                            ${data.percentage}%
                        </div>
                    </div>
                </div>
            `;
        }
    }
    
    function showInvoiceNotification(invoice) {
        console.log('‚úÖ Rechnung verarbeitet:', invoice);
    }
    
    function showJobComplete(summary) {
        const statusDiv = document.getElementById('upload-status');
        if (statusDiv) {
            statusDiv.innerHTML = `
                <div style="padding: 20px; background: #4CAF50; color: white; border-radius: 10px; margin: 20px 0;">
                    <h3>‚úÖ Verarbeitung abgeschlossen!</h3>
                    <p>Verarbeitete Rechnungen: ${summary.total_invoices || 0}</p>
                    <button onclick="window.location.href='/job/${currentJobId}'" 
                            style="background: white; color: #003856; padding: 10px 20px; 
                                   border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                        üìä Ergebnisse anzeigen
                    </button>
                </div>
            `;
        }
        if (ws) ws.close();
    }
    
    function showError(error) {
        console.error('‚ùå Error:', error);
    }
    
    </script>


<style>
  /* ==== Schwarzes-Loch-Demo ‚Äì Optik */  

  #upload-dropzone {
    position: relative;
    overflow: hidden;
    border-radius: 24px;
    min-height: 420px;
    background: radial-gradient(circle at 20% 0%,
                rgba(40, 60, 120, 0.85) 0,
                rgba(4, 8, 20, 1) 55%,
                rgba(0, 0, 0, 1) 100%);
    box-shadow:
      0 32px 80px rgba(0, 0, 0, 0.8),
      0 0 0 1px rgba(255, 255, 255, 0.02);
    cursor: copy;
  }

  .bh-bg {
    position: absolute;
    inset: 0;
    background-image:
      radial-gradient(1px 1px at 10% 20%, rgba(255, 255, 255, 0.6) 0, transparent 50%),
      radial-gradient(1px 1px at 80% 30%, rgba(255, 255, 255, 0.7) 0, transparent 50%),
      radial-gradient(1px 1px at 50% 80%, rgba(255, 255, 255, 0.5) 0, transparent 50%),
      radial-gradient(2px 2px at 30% 50%, rgba(255, 255, 255, 0.4) 0, transparent 60%);
    opacity: 0.5;
    animation: bh-starsTwinkle 10s ease-in-out infinite alternate;
    z-index: 1;
  }

  .bh-horizon {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 260px;
    height: 260px;
    margin: -130px;
    border-radius: 50%;
    background: #000000;
    box-shadow:
      0 0 0 4px #000000,
      0 0 80px rgba(0, 0, 0, 1);
    z-index: 5;
  }

  .bh-disc {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 380px;
    height: 380px;
    margin: -190px;
    border-radius: 50%;
    background:
      conic-gradient(
        from 150deg,
        rgba(255, 150, 60, 0.15) 0deg,
        rgba(255, 210, 120, 0.95) 40deg,
        rgba(255, 250, 230, 1.0) 70deg,
        rgba(255, 200, 110, 0.95) 110deg,
        rgba(220, 120, 60, 0.9) 150deg,
        rgba(140, 60, 30, 0.8) 200deg,
        rgba(80, 30, 15, 0.4) 260deg,
        rgba(255, 150, 60, 0.15) 360deg
      );
    -webkit-mask: radial-gradient(circle at center,
        transparent 0,
        transparent 60%,
        black 68%,
        black 74%,
        transparent 82%,
        transparent 100%);
    mask: radial-gradient(circle at center,
        transparent 0,
        transparent 60%,
        black 68%,
        black 74%,
        transparent 82%,
        transparent 100%);
    filter: blur(1.1px);
    box-shadow:
      0 0 35px rgba(255, 190, 120, 0.7),
      0 0 80px rgba(255, 150, 70, 0.65);
    animation: bh-discSpin 28s linear infinite;
    z-index: 3;
  }

  .bh-lensing-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 320px;
    height: 320px;
    margin: -160px;
    border-radius: 50%;
    background:
      radial-gradient(circle at center,
        rgba(255, 255, 255, 0.0) 60%,
        rgba(255, 255, 255, 0.5) 67%,
        rgba(255, 220, 200, 0.2) 75%,
        transparent 100%);
    mix-blend-mode: screen;
    filter: blur(1.0px);
    opacity: 0.8;
    animation: bh-ringPulse 7s ease-in-out infinite;
    z-index: 6;
  }

  .bh-ui {
    position: relative;
    z-index: 10;
    max-width: 380px;
    margin: 40px;
    color: #f7f9ff;
    text-shadow: 0 8px 24px rgba(0, 0, 0, 0.9);
  }

  .bh-ui-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 4px 12px;
    border-radius: 999px;
    font-size: 0.75rem;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    background: radial-gradient(circle at 0 0,
                rgba(255, 180, 120, 0.6) 0,
                rgba(18, 27, 68, 0.95) 45%,
                rgba(12, 18, 40, 1) 100%);
    box-shadow:
      0 0 20px rgba(255, 170, 90, 0.4),
      0 0 0 1px rgba(255, 255, 255, 0.05);
  }

  .bh-ui-title {
    margin-top: 14px;
    margin-bottom: 8px;
    font-size: 1.5rem;
    font-weight: 600;
  }

  .bh-ui-text {
    margin: 0 0 16px;
    font-size: 0.95rem;
    line-height: 1.5;
    color: rgba(231, 236, 255, 0.88);
  }

  .bh-ui-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: center;
  }

  .bh-btn-primary {
    border: none;
    outline: none;
    border-radius: 999px;
    padding: 10px 20px;
    font-size: 0.95rem;
    font-weight: 500;
    color: #050814;
    background: radial-gradient(circle at 30% 0%,
                #ffe6c6 0,
                #ffb25a 35%,
                #ff7b35 70%,
                #ff5a2a 100%);
    box-shadow:
      0 12px 30px rgba(0, 0, 0, 0.85),
      0 0 0 1px rgba(255, 255, 255, 0.12);
    cursor: pointer;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
  }

  .bh-btn-primary:hover {
    transform: translateY(-1px);
    box-shadow:
      0 16px 38px rgba(0, 0, 0, 0.95),
      0 0 0 1px rgba(255, 255, 255, 0.22);
  }

  .bh-hint {
    font-size: 0.8rem;
    color: rgba(207, 216, 255, 0.82);
  }

  #upload-dropzone.bh-drag-over .bh-disc {
    box-shadow:
      0 0 50px rgba(255, 210, 140, 0.9),
      0 0 120px rgba(255, 150, 70, 0.9);
  }

  #upload-dropzone.bh-drag-over .bh-horizon {
    box-shadow:
      0 0 0 4px #000,
      0 0 110px rgba(0, 0, 0, 1);
  }

  body.demo-running #upload-dropzone .bh-disc,
  body.demo-processing #upload-dropzone .bh-disc {
    animation: bh-discSpin 6s linear infinite;
    box-shadow:
      0 0 70px rgba(255, 230, 170, 1),
      0 0 140px rgba(255, 160, 75, 1);
  }

  .bh-particles-layer {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 4;
  }

  .bh-particle {
    position: absolute;
    width: 6px;
    height: 6px;
    border-radius: 999px;
    background: radial-gradient(circle at 30% 0,
                #fff7e1 0,
                #ffc86c 40%,
                #ff7a35 75%,
                rgba(255, 120, 40, 0) 100%);
    box-shadow:
      0 0 12px rgba(255, 190, 120, 0.9),
      0 0 24px rgba(255, 140, 60, 0.7);
  }

  @keyframes bh-discSpin {
    to { transform: rotate(360deg); }
  }

  @keyframes bh-starsTwinkle {
    0%   { opacity: 0.35; transform: translate3d(0, 0, 0); }
    100% { opacity: 0.65; transform: translate3d(-10px, -6px, 0); }
  }

  @keyframes bh-ringPulse {
    0%   { opacity: 0.6; transform: scale(0.98); }
    50%  { opacity: 0.95; transform: scale(1.02); }
    100% { opacity: 0.7; transform: scale(1.0); }
  }
</style>

<script>
  (function() {
    const shell = document.getElementById('upload-dropzone');
    if (!shell) return;

    const fileInput =
      document.querySelector('#upload-form input[type="file"]') ||
      document.querySelector('input[type="file"][name="files"]') ||
      document.querySelector('input[type="file"]');

    const browseBtn     = document.getElementById('bh-browse-btn');
    const body          = document.body;
    const particlesLayer = shell.querySelector('.bh-particles-layer');

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    ['dragenter','dragover','dragleave','drop'].forEach(ev => {
      shell.addEventListener(ev, preventDefaults, false);
    });

    ['dragenter','dragover'].forEach(ev => {
      shell.addEventListener(ev, () => shell.classList.add('bh-drag-over'), false);
    });

    ['dragleave','drop'].forEach(ev => {
      shell.addEventListener(ev, () => shell.classList.remove('bh-drag-over'), false);
    });

    shell.addEventListener('drop', (e) => {
      const dt = e.dataTransfer;
      const files = dt && dt.files;
      if (!files || !files.length) return;

      if (fileInput) {
        try {
          fileInput.files = files;
        } catch (err) {
          console.warn('Konnte FileList nicht direkt zuweisen:', err);
        }
      }

      spawnParticles(16);
    });

    if (browseBtn && fileInput) {
      browseBtn.addEventListener('click', () => fileInput.click());
    }

    const submitBtn =
      document.getElementById('upload-submit') ||
      document.querySelector('button[type="submit"][form="upload-form"]') ||
      document.querySelector('#upload-form button[type="submit"]');

    if (submitBtn) {
      submitBtn.addEventListener('click', () => {
        body.classList.add('demo-running');
        spawnParticles(28);
        setTimeout(() => body.classList.remove('demo-running'), 11000);
      });
    }

    function spawnParticles(count) {
      if (!particlesLayer) return;
      const rect = shell.getBoundingClientRect();
      const cx = rect.width / 2;
      const cy = rect.height / 2;

      for (let i = 0; i < count; i++) {
        const p = document.createElement('div');
        p.className = 'bh-particle';

        const angle = Math.random() * Math.PI * 2;
        const radius = 190 + Math.random() * 140;

        p.style.left = (cx + Math.cos(angle) * radius) + 'px';
        p.style.top  = (cy + Math.sin(angle) * radius) + 'px';

        particlesLayer.appendChild(p);

        const duration = 3500 + Math.random() * 2500;
        const start = performance.now();

        function animate(now) {
          const t = (now - start) / duration;
          if (t >= 1) {
            p.remove();
            return;
          }
          const eased = t * t;
          const r = radius * (1 - eased * 0.9);
          const x = cx + Math.cos(angle) * r;
          const y = cy + Math.sin(angle) * r;

          p.style.left = x + 'px';
          p.style.top  = y + 'px';
          p.style.opacity = String(1 - t);
          requestAnimationFrame(animate);
        }
        requestAnimationFrame(animate);
      }
    }
  })();
</script>


<style>
  /* Fixiert die vertikale Position des Schwarzen Lochs im Drop-Bereich,
     damit es nicht mehr nach oben springt, wenn man den Bereich verl√§sst. */
  .bh-horizon,
  .bh-disc,
  .bh-lensing-ring {
    top: 220px; /* bei Bedarf sp√§ter anpassen: gr√∂√üer = weiter nach unten */
  }
</style>

<!-- SBS Chat Widget -->
<link rel="stylesheet" href="https://chat.sbsdeutschland.com/static/chat-widget.css">
<script src="https://chat.sbsdeutschland.com/static/chat-widget.js" defer></script>
</body>
</html>
